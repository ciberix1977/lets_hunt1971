<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Let's Hunt ‚Äî Desaf√≠o</title>
  <meta property="og:title" content="üåë Let's Hunt ‚Äî Desaf√≠o">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #090c14;
      color: #d9c8b0;
      font-family: 'Courier New', monospace;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      padding: 20px;
    }
    .container {
      max-width: 600px;
      margin: auto;
      text-align: center;
    }
    h1 {
      font-size: 1.9em;
      margin: 25px 0;
      color: #c1a37a;
      text-shadow: 0 0 10px rgba(140, 90, 50, 0.5);
    }
    .challenge-box {
      background: rgba(15, 20, 35, 0.85);
      border: 1px solid #4a3525;
      border-radius: 10px;
      padding: 25px;
      margin: 25px 0;
      text-align: left;
      line-height: 1.6;
      font-size: 1.2em;
    }
    .btn {
      display: inline-block;
      padding: 18px 40px;
      font-size: 1.3em;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      margin: 20px 0;
      min-width: 220px;
      transition: all 0.2s;
      background: #1e3a1e;
      color: white;
      border: 2px solid #4caf50;
      box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
    }
    .btn:hover {
      background: #1a301a;
      transform: translateY(-2px);
      box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
    }
    .hidden { display: none; }
    #countdown {
      font-size: 3.2em;
      font-weight: bold;
      color: #ffb347;
      margin: 30px 0;
      text-shadow: 0 0 12px rgba(255, 179, 71, 0.6);
      font-family: 'Arial Black', sans-serif;
    }
    .status {
      margin-top: 15px;
      font-size: 0.95em;
      color: #a89a85;
    }
    .note {
      font-size: 0.9em;
      color: #64748b;
      margin-top: 15px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üåë DESAF√çO PERSONAL</h1>
    
    <div class="challenge-box" id="challenge-text">
      <!-- Se llena din√°micamente -->
    </div>

    <button id="btn-confirm" class="btn">‚úÖ CONFIRMAR ‚Äî Comenzar desaf√≠o</button>

    <div id="countdown" class="hidden">15:00</div>
    <div id="status" class="status hidden">‚è±Ô∏è Desaf√≠o en progreso...</div>
    <p class="note">*El Vigilante te observa en tiempo real.*</p>
  </div>

  <script>
    // === DATOS DEL DESAF√çO (recibidos por URL) ===
    const urlParams = new URLSearchParams(window.location.search);
    const m = parseInt(urlParams.get('m')) || 1; // misi√≥n
    const d = parseInt(urlParams.get('d')) || 1; // desaf√≠o (1, 2 o 3)
    const token = urlParams.get('token') || 'xxxxxx';

    // Base de datos: solo los textos de los desaf√≠os (sin reglas, sin intro)
    const CHALLENGES = {
      1: [
        "Ve al centro de la plaza. Levanta los dos brazos como avi√≥n. Apoya la cabeza en el hombro izquierdo. Camina diez pasos adelante y diez para atr√°s, mientras mueves los brazos como un ave.",
        "Camina cinco pasos hacia adelante. Detente. Di en voz clara: ¬´Este momento es m√≠o¬ª. Espera tres segundos. Vuelve a tu lugar original.",
        "Mira directamente a la c√°mara. Parpadea solo cuando lo necesites. Mant√©n la mirada fija durante veinte segundos. No sonr√≠as. No hables. No te muevas."
      ],
      2: [
        "Si√©ntate en el suelo. Cruza las piernas. Coloca las manos en las rodillas, palmas hacia arriba. Mant√©n la postura durante treinta segundos, sin mover un m√∫sculo.",
        "Camina en c√≠rculo alrededor de un √°rbol. Haz tres vueltas completas, mirando siempre el tronco. No aceleres.",
        "Tumba una moneda en el suelo. Arrod√≠llate. M√≠rala durante quince segundos. Lev√°ntate sin tocarla."
      ],
      3: [
        "P√°rate junto a un banco vac√≠o. Incl√≠nate hacia √©l, como si fueras a sentarte, pero no toques la superficie. Mant√©n la postura quince segundos.",
        "Camina de puntillas durante veinte pasos. Brazos cruzados en el pecho. No bajes los talones.",
        "Toma una hoja del suelo. Sost√©nla frente a tus ojos. Camina cinco pasos hacia adelante sin soltarla. D√©jala caer suavemente."
      ],
      4: [
        "Encuentra una piedra plana. Col√≥cala sobre tu cabeza. Camina diez pasos en l√≠nea recta sin que se caiga.",
        "Si√©ntate en el suelo. Dibuja un c√≠rculo en la tierra con el dedo. Cruza el c√≠rculo tres veces con una raya, sin levantar el dedo.",
        "Elige un sonido del parque (p√°jaro, viento, colectivo). Reprod√∫celo con tu boca durante ocho segundos. No imites, recrea."
      ]
    };

    // Validar token m√≠nimo (6 caracteres alfanum√©ricos)
    if (!/^[a-z0-9]{6}$/i.test(token)) {
      document.body.innerHTML = `<div style="padding:50px;text-align:center;color:#d9c8b0;background:#090c14">
        <h2 style="color:#c14747">üîó Enlace inv√°lido</h2>
        <p>Este desaf√≠o ya expir√≥.</p>
      </div>`;
      throw new Error("Token inv√°lido");
    }

    // Mostrar desaf√≠o
    const challengeText = CHALLENGES[m]?.[d-1] || CHALLENGES[1][0];
    document.getElementById('challenge-text').textContent = challengeText;

    // Bot√≥n de confirmaci√≥n
    document.getElementById('btn-confirm').onclick = () => {
      document.getElementById('btn-confirm').classList.add('hidden');
      document.getElementById('countdown').classList.remove('hidden');
      document.getElementById('status').classList.remove('hidden');
      
      // Iniciar cron√≥metro
      const timeLimit = [900, 720, 600, 480][m-1] || 900; // 15, 12, 10, 8 min
      startTimer(timeLimit);

      // Notificar al Vigilante (simulado; en producci√≥n: WebSocket o fetch)
      console.log(`[Vigilante] Jugador acept√≥ desaf√≠o M${m}D${d}. Token: ${token}`);
      
      // En producci√≥n, podr√≠as enviar:
      // fetch(`/api/notify-vigilante?token=${token}&status=started`);
    };

    function startTimer(totalSeconds) {
      const el = document.getElementById('countdown');
      let secs = totalSeconds;
      const timer = setInterval(() => {
        if (secs <= 0) {
          clearInterval(timer);
          fail();
          return;
        }
        const m = Math.floor(secs / 60);
        const s = secs % 60;
        el.textContent = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        secs--;
      }, 1000);
    }

    function fail() {
      document.body.innerHTML = `<div style="padding:50px;text-align:center;color:#d9c8b0;background:#090c14">
        <h2 style="color:#c14747">misi√≥n anulada</h2>
        <p>El Vigilante ha cerrado los ojos.</p>
        <small>Let's Hunt ‚Äî CABA</small>
      </div>`;
      
      // Notificar al Vigilante
      console.log(`[Vigilante] Desaf√≠o M${m}D${d} fallido. Token: ${token}`);
    }

    // API para que el Vigilante valide (llamado desde su panel)
    window.validateChallenge = () => {
      alert("‚úÖ Desaf√≠o validado. Coordenadas enviadas por WhatsApp.");
      document.body.innerHTML = `<div style="padding:50px;text-align:center;color:#d9c8b0;background:#090c14">
        <h2 style="color:#4caf50">misi√≥n completada</h2>
        <p>Las coordenadas del QR fueron enviadas por WhatsApp.</p>
        <small>Let's Hunt ‚Äî CABA</small>
      </div>`;
    };
  </script>
</body>
</html>
